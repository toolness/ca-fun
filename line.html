<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
html, body {
  font-family: sans-serif;
}
</style>
<title>Line Test</title>
<h1>Line Test</h1>
<script src="vendor/p5.js"></script>
<script src="grid.js"></script>
<script>
var grid;
var lineEndpoints = [];

function setup() {
  var i;

  grid = new Grid({
    width: 48,
    squareSize: 8
  });
  grid.createCanvas();

  do {
    grid.createRandom();
    for (i = 0; i < 3; i++) grid.smooth(0.6);
  } while (grid.getSquare(grid.width / 2, grid.width / 2) === grid.FILLED);

  for (i = 0; i < grid.width; i++)
    lineEndpoints.push([i, 0]);
  for (i = 0; i < grid.width; i++)
    lineEndpoints.push([grid.width - 1, i]);
  for (i = grid.width - 1; i > 0; i--)
    lineEndpoints.push([i, grid.width - 1]);
  for (i = grid.width - 1; i > 0; i--)
    lineEndpoints.push([0, i]);
}

function drawLine(grid, x1, y1, x2, y2, col) {
  var slope = Math.abs((y1 - y2) / (x1 - x2));
  var y = y1;
  var x = x1;
  var xDir = (x2 >= x1) ? 1 : -1;
  var yDir = (y2 >= y1) ? 1 : -1;
  var isObstructed = false;
  var ensureNotObstructed = function(x, y) {
    if (grid.getSquare(Math.floor(x), Math.floor(y)) === grid.EMPTY) {
      return true;
    }
    isObstructed = true;
    return false;
  }

  if (Math.abs(slope) === Infinity) {
    while (y != y2 && ensureNotObstructed(x, y)) {
      grid.drawSquare(x, y, col);
      y += yDir;
    }
  } else if (slope <= 1) {
    while (x != x2 && ensureNotObstructed(x, y)) {
      grid.drawSquare(x, Math.floor(y), col);
      y += slope * yDir;
      x += xDir;
    }
  } else if (slope > 1) {
    while (y != y2 && ensureNotObstructed(x, y)) {
      grid.drawSquare(Math.floor(x), y, col);
      x += 1 / slope * xDir;
      y += yDir;
    }
  }

  if (!isObstructed && ensureNotObstructed(x2, y2)) {
    grid.drawSquare(x2, y2, col);
  }
}

function draw() {
  var i = frameCount % (lineEndpoints.length);
  var endpoint = lineEndpoints[i];

  grid.draw();
  drawLine(grid, grid.width / 2, grid.width / 2, endpoint[0], endpoint[1],
           "crimson");
}
</script>
